<?php
function clearconsole(){
    echo "\e[H\e[J";
}
function playagain(){
    $check = false;
    while($check == false){
        $playagain = readline("Do you wanna play again? (Y/N): ");
        if(strtolower($playagain) == "y"){
            chooseoption();
            $check = true;
        }
        else if(strtolower($playagain) == "n"){
            echo "Ok, Bye!" . "\n";
            $check = true;
            exit();
        }
        else{echo "Unknown Input, Please choose again " . "\n"; $check = false;}
    }
}
function lookifwin(){
    global $fields;
    global $playertag;
    $checkiffull = 0;
    $xwins = false;
    $owins = false;
    for($r = 1; $r <= 3; $r++){
        if($fields[$r][1] == "x" && $fields[$r][2] == "x" && $fields[$r][3] == "x"){
            $xwins = true;
            echo "1";
        }
        if($fields[$r][1] == "o" && $fields[$r][2] == "o" && $fields[$r][3] == "o"){
            $owins = true;
            echo "2";
        }
        if($fields[1][$r] == "x" && $fields[2][$r] == "x" && $fields[3][$r] == "x"){
            $xwins = true;
            echo "3";
        }
        if($fields[1][$r] == "o" && $fields[2][$r] == "o" && $fields[3][$r] == "o"){
            $owins = true;
            echo "4";
        }
    }
    if($fields[1][1] == "x" && $fields[2][2] == "x" && $fields[3][3] == "x"){
        $xwins = true;
        echo "5";
    }
    if($fields[1][1] == "o" && $fields[2][2] == "o" && $fields[3][3] == "o"){
        $xwins = true;
        echo "6";
    }
    if($fields[3][3] == "x" && $fields[2][2] == "x" && $fields[1][1] == "x"){
        $xwins == true;
        echo "7";
    }
    if($fields[3][3] == "o" && $fields[2][2] == "o" && $fields[1][1] == "o"){
        $xwins == true;
        echo "8";
    }
    if($xwins == true){
        echo "\n";
        echo $playertag[0] . " has won, Congratulations!" . "\n" . "\n";
        playagain();
    }
    else if($owins == true){
        echo "\n";
        echo $playertag[1] . " has won, Congratulations!" . "\n" . "\n";
        playagain();
    }
    for($ypos = 1; $ypos <= 3; $ypos++){
        for($xpos = 1; $xpos <= 3; $xpos++){
            if($fields[$ypos][$xpos] != " "){
                $checkiffull += 1;
            }
        }
    }
    if($checkiffull >= 9){
        echo "Tie!" . "\n";
        playagain();
    }
}
function loadfield($yposletter, $xposnumber){
    global $actualplayer;
    global $playertag;
    global $fields;
    if ($actualplayer == 0){
        $x_or_o = "x";
    }
    else if ($actualplayer == 1){
        $x_or_o = "o";
    }
    $fields[$yposletter][$xposnumber] = $x_or_o;
    echo "Actual Player: " . $playertag[$actualplayer] ."\n";
    echo "     1   2   3 " . "\n";
    echo " a  [" . $fields[1][1] . "] [" . $fields[1][2] . "] [" . $fields[1][3] . "] " . "\n";
    echo " b  [" . $fields[2][1] . "] [" . $fields[2][2] . "] [" . $fields[2][3] . "] " . "\n";
    echo " c  [" . $fields[3][1] . "] [" . $fields[3][2] . "] [" . $fields[3][3] . "] " . "\n";
}

function playervsplayer(){
    global $playertag;
    global $actualplayer;
    global $fields;
    $playertag[0] = readline("Player1 Name: ");
    $playertag[1] = readline("Player2 Name: ");
    $actualplayer = 0;
    clearconsole();
    loadfield(10, 10);
    for ($z = 1; $z <= 9; $z++){
        $check = true;
        while($check == true){
            $check = true;
            $choosefield = readline($playertag[$actualplayer] . ", please choose a Field: ");
            $choosefieldy = substr($choosefield, 0, 1);
            $choosefieldx = substr($choosefield, 1, 1);
            switch($choosefieldy){
                case "a": $choosefieldy = 1; break;
                case "b": $choosefieldy = 2; break;
                case "c": $choosefieldy = 3; break;
                default: echo "Error" . "\n"; 
            }
            if($fields[$choosefieldy][$choosefieldx] != " "){
                echo "--Can't take this field, please choose again" . "\n";
                $check = true;
            }
            else{$check = false;}
        }
        clearconsole();
        loadfield($choosefieldy, $choosefieldx);
        lookifwin();
        if ($actualplayer == 0){
            $actualplayer = 1;
        }
        else if ($actualplayer == 1){
            $actualplayer = 0;
        }
        echo "\n";
    }
}
function playervscomputer(){
    global $playertag;
    global $actualplayer;
    global $fields;
    $checkcomputer = true;
    $playertag[0] = readline("Player1 Name: ");
    $playertag[1] = "Computer1";
    $actualplayer = 0;
    clearconsole();
    loadfield(10, 10);
    for ($z = 1; $z <= 9; $z++){
        $check = true;
        while($check == true){
            $check = true;
            if($actualplayer == 1){
                while($checkcomputer == true){
                    $choosefieldy = random_int(1, 3);
                    $choosefieldx = random_int(1, 3);
                    if($fields[$choosefieldy][$choosefieldx] != " "){
                        $check = true;
                    }
                    else{$check = false;}
                }
            }
            else{
                $choosefield = readline($playertag[$actualplayer] . ", please choose a Field: ");
                $choosefieldy = substr($choosefield, 0, 1);
                $choosefieldx = substr($choosefield, 1, 1);
                switch($choosefieldy){
                    case "a": $choosefieldy = 1; break;
                    case "b": $choosefieldy = 2; break;
                    case "c": $choosefieldy = 3; break;
                    default: echo "Error" . "\n"; 
                }
            }
            if($fields[$choosefieldy][$choosefieldx] != " "){
                echo "--Can't take this field, please choose again" . "\n";
                $check = true;
            }
            else{$check = false;}
        }
        clearconsole();
        loadfield($choosefieldy, $choosefieldx);
        lookifwin();
        if ($actualplayer == 0){
            $actualplayer = 1;
        }
        else if ($actualplayer == 1){
            $actualplayer = 0;
        }
        echo "\n";
    }
}
function computervscomputer(){

}
function chooseoption(){
    global $options;
    echo "***********************************" . "\n";
    echo "Choose between these options" . "\n";
    for($i = 0; $i < count($options); $i++){
        echo "[" . $i . "] " . $options[$i] . "\n";
    }
    echo "\n";
    $controlchoose = false;
    while($controlchoose == false){
        $choosed = readline(": ");
        switch($choosed){
            case 0: 
                echo "Ok! " . "\n";
                playervsplayer();
                $controlchoose = true;
                break;
            case 1: 
                echo "Ok! " . "\n";
                playervscomputer();
                $controlchoose = true;
                break;
            case 2: 
                echo "Ok! " . "\n";
                computervscomputer();
                $controlchoose = true;
                break;
            case 3: 
                echo "Ok! " . "\n";
                exit();
                break;
            default: 
            echo "Invalid Input, please choose again" . "\n";
            $controlchoose = false;
    
        }
    }
}
$playertag = array();
$options = array();
$fields = array();
for($ypos = 1; $ypos <= 3; $ypos++){
    for($xpos = 1; $xpos <= 3; $xpos++){
        $fields[$ypos][$xpos] = " ";
    }
}
$options[0] = "Player vs Player";
$options[1] = "Player vs Computer";
$options[2] = "Computer vs Computer";
$options[3] = "Exit";

chooseoption($options);
?>
